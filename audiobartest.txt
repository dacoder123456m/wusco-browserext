// ==UserScript==
// @name         Volume Change Detector with ChromeOS API
// @namespace    http://your.namespace.com
// @version      0.3
// @description  Detect volume changes and show a bar in the bottom right
// @author       Your Name
// @match        *://*/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    const context = new AudioContext();
    const analyser = context.createAnalyser();
    analyser.fftSize = 32;

    const bufferLength = analyser.frequencyBinCount;
    const dataArray = new Uint8Array(bufferLength);

    const volumeBar = document.createElement('div');
    volumeBar.style.position = 'fixed';
    volumeBar.style.bottom = '10px';
    volumeBar.style.right = '10px';
    volumeBar.style.width = '100px';
    volumeBar.style.height = '10px';
    volumeBar.style.backgroundColor = 'green';
    volumeBar.style.opacity = '0.7';
    volumeBar.style.transition = 'width 0.5s';

    document.body.appendChild(volumeBar);

    chrome.audio.getDevices(function(devices) {
        const inputDevice = devices.find(device => device.streamType === 'INPUT');
        if (!inputDevice) {
            console.error('No input device found');
            return;
        }

        chrome.audio.onLevelChanged.addListener(function(info) {
            if (info.deviceId !== inputDevice.id) {
                return;
            }

            const averageVolume = info.level;
            updateVolumeBar(averageVolume);
        });
    });

    function updateVolumeBar(volume) {
        volumeBar.style.width = `${volume * 100}%`;
    }
})();
